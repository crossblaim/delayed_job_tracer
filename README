= Delayed Job Tracer Plugin for Rails

RDoc URL: http://rdoc.info/projects/kjohnston/delayed_job_tracer

Delayed Job Tracer is designed to monitor the delayed_job plugin, which was extracted from Shopify (http://github.com/tobi/delayed_job/).  It will alert you via e-mail if something goes wrong, such as the delayed_job process crashes or one of its jobs fails or takes too long to complete.

This plugin also detects wither e-mails sent through delayed_job are actually being delivered by sending test messages to an e-mail account then checking that account to ensure they were processed and dispatched via the delayed_job queue.  The e-mail delivery detection allows you to be notified if e-mails can't be sent out either because of delayed_job having choked or because of an issue with the e-mail account the application uses to send e-mail.


== Primary Features

* Sends an e-mail notification when delayed_job crashes or is unable to complete a job in a reasonable amount of time.
* Sends an e-mail notification when the Rails application is unable to successfully deliver e-mails via delayed_job.
* Circumvents the need for a process monitoring tool like Monit or God for delayed_job processes.
* Keeps memory usage low by working outside of Rails.


== Why use a Cron'd ruby process to monitor delayed_job and e-mail delivery?

* Cron is often considered to be more reliable than process monitoring tools like Monit or God.
* The Cron'd ruby process only uses a modest amount of memory (~27MB) for a few seconds at regular intervals, whereas a rake task or runner would equate to the entire size of the Rails application, with a memory footprint that grows over time.


== Why use a Perl Script to send alert e-mails to admins?

* It's fast
* It doesn't rely on the Rails application
* It doesn't rely on the delayed_job process you're monitoring with this plugin


== Prerequisites

Note package installations are per Ubuntu 9.04 (Jaunty Jackalope), you may need to find alternate packages, depending on your platform.

1) XML Packages (pre-requisites for mms2r gem):

	sudo apt-get install libxml2-dev libxslt-dev
	
2) Install Gems:

	sudo gem install daemons tmail tlsmail		(omit daemons if you're not using it to daemonize delayed_job)
	sudo gem install mms2r -v 2.4.1

3) sendEmail Perl script:

	Download from http://caspian.dotconf.net/menu/Software/SendEmail and follow the setup instructions, or just follow these instructions:
	
		wget -c http://caspian.dotconf.net/menu/Software/SendEmail/sendEmail-v1.56.tar.gz
		tar xvfz sendEmail-v1.56.tar.gz
		sudo cp -a sendEmail-v1.56/sendEmail /usr/local/bin
		chmod +x /usr/local/bin/sendEmail
		
		Run it to be sure it works:
		
		sendEmail
		
		Cleanup:
		
		rm -rf sendEmail-v1.56*
	
4) Perl SSL packages (needed for sendEmail to send email):
		
		sudo apt-get install libnet-ssleay-perl libcrypt-ssleay-perl libio-socket-ssl-perl


== Installation

1) Install the plugin:

	script/plugin install git://github.com/kjohnston/delayed_job_tracer.git
	
2) Generate the config file:

	script/generate delayed_job_tracer
	
2) Mix the DelayedJobTracerMailer module into your ActionMailer mailer class (whatever you named it).

	Example:
	
		class Mailer < ActionMailer::Base
		  include DelayedJobTracerMailer
		end


== Configuration

* Create a 'Monitoring' label in the e-mail account you configure the plugin to send test messages to and a filter to move all incoming messages with '[Monitoring]' in the subject line to this folder (or label if you're using Gmail).  Set the name of this folder in the config/delayed_job_tracer_config.yml file - as it will be the folder that the ruby process checks for test messages.

* Add a Cron job to your server:

	- Example for running every 15 minutes, replace with your actual app and ruby locations -

	*/15 * * * * cd /opt/apps/app_name/current/vendor/plugins/delayed_job_tracer/ruby && /usr/local/bin/ruby runner.rb
	
* Finish configuring your settings in the config/delayed_job_tracer_config.yml file.  Your database and ActionMailer config will be applied via the generator, but you'll still need to provide an alternate e-mail account to send administrative notifications through, provide the admin's e-mail address and so forth.


== License

The MIT License

Copyright (c) 2010 Kenny Johnston

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.